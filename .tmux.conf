bind-key R source ~/.tmux.conf \; display-message 'config reloaded!'

#-----------------------------------------------------------------------------
# terminal
#-----------------------------------------------------------------------------

# auto-set terminal title to current window pane's title
set-option -g set-titles on

# enable 256-color support for pretty colorschemes in Vim
set-option -g default-terminal 'screen-256color'

# allow Vim to recieve modifier keys: Shift, Control, Alt
set-window-option -g xterm-keys on

# prevent tmux from catching modifier keys meant for Vim
set-option -s escape-time 1

# allow set-titles to change the window title under XTerm
# http://opennomad.com/content/goodbye-screen-hello-tmux
# prevent standout from appearing as italics under URxvt
# http://comments.gmane.org/gmane.comp.terminal-emulators.tmux.user/1927
set-option -g terminal-overrides 'xterm*:XT,rxvt-unicode*:sitm@'

#-----------------------------------------------------------------------------
# appearance
#-----------------------------------------------------------------------------

# put status bar at top of terminal window
set-option -g status-position top

# Colors from the Zukitwo-Dark GTK+ theme:
# http://lassekongo83.deviantart.com/art/Zukitwo-203936861
set-window-option -g window-status-current-fg '#2c2c2c'
set-window-option -g window-status-current-bg '#c9c9c9'
set-option -g pane-active-border-fg blue
set-option -g pane-active-border-bg default
set-option -g pane-border-fg '#4c4c4c'
set-option -g pane-border-bg default
set-option -g status-fg '#e6e6e6'
set-option -g status-bg '#3c3c3c'

# Common UI interaction cues from Blueprint CSS:
# http://blueprintcss.org/tests/parts/forms.html
set-option -g message-fg '#514721' # notice (yellow)
set-option -g message-bg '#ffd324' # notice (yellow)
set-window-option -g mode-fg '#514721' # notice (yellow)
set-window-option -g mode-bg '#ffd324' # notice (yellow)
set-window-option -g window-status-bell-fg '#d5edf8' # info (blue)
set-window-option -g window-status-bell-bg '#205791' # info (blue)
set-window-option -g window-status-content-fg '#e6efc2' # success (green)
set-window-option -g window-status-content-bg '#264409' # success (green)
set-window-option -g window-status-activity-fg '#fbe3e4' # error (red)
set-window-option -g window-status-activity-bg '#8a1f11' # error (red)

# Status bar with Powerline symbols and colors
# https://bitbucket.org/sjl/dotfiles/src/tip/tmux/tmux.conf
# http://www.tylercipriani.com/2013/09/12/important-lines-in-my-tmux.html
# https://github.com/Lokaltog/powerline/blob/develop/powerline/bindings/tmux/powerline.conf
set-option -g status on
set-option -g status-utf8 on
set-option -g status-justify right

set-option -g status-fg colour252
set-option -g status-bg colour234

set-option -g status-left-length 102
set-option -g status-left '#[reverse,bold] #h #[default,bg=colour238] #S:#I.#P #[default,fg=colour238]#[fg=colour117] #F#[default] #T'

set-option -g status-right-length 26
set-option -g status-right '#[fg=colour238]#[default,bg=colour238] %d %b %Y #[reverse,bold] %a %R '

set-window-option -g window-status-format '  #[bold]#I#F#[nobold]#W  '
set-window-option -g window-status-separator ''

set-window-option -g window-status-current-fg colour231
set-window-option -g window-status-current-bg colour31
set-window-option -g window-status-current-format '#[reverse,fg=colour234]#[noreverse,fg=colour117] #I#F#[default,bold]#W #[nobold,fg=colour234]'

#-----------------------------------------------------------------------------
# windows
#-----------------------------------------------------------------------------

# create window
bind-key -n M-e command-prompt "new-window -n '%%'"
bind-key -n M-E command-prompt -I '#W' "rename-window '%%'"

# focus window
set-option -g mouse-select-window on
bind-key -n M-, previous-window
bind-key -n M-. next-window
bind-key -n M-o last-window

# focus by number
set-option -g base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on
bind-key -n M-0 choose-window
bind-key -n M-1 select-window -t :1
bind-key -n M-2 select-window -t :2
bind-key -n M-3 select-window -t :3
bind-key -n M-4 select-window -t :4
bind-key -n M-5 select-window -t :5
bind-key -n M-6 select-window -t :6
bind-key -n M-7 select-window -t :7
bind-key -n M-8 select-window -t :8
bind-key -n M-9 select-window -t :9

# swap window
bind-key -n M-< swap-window -t :-1
bind-key -n M-> swap-window -t :+1

# monitor window
bind-key -n M-k set-window-option monitor-activity
bind-key -n M-q command-prompt -p 'monitor-silence (seconds)' -I 0 'set-window-option monitor-silence %%'
bind-key -n M-j command-prompt -p 'monitor-content (fnmatch)' "set-window-option monitor-content '%%'"
bind-key -n M-J set-window-option monitor-content

#-----------------------------------------------------------------------------
# panes
#-----------------------------------------------------------------------------

# create pane
bind-key -n M-c split-window
bind-key -n M-r split-window -h

# focus pane or Vim split (if pane running Vim)
# http://robots.thoughtbot.com/post/53022241323
bind-key -n M-d select-pane -l
bind-key -n M-h if-shell 'test "#{pane_current_command}" = vim' 'send-keys M-h' 'select-pane -L'
bind-key -n M-t if-shell 'test "#{pane_current_command}" = vim' 'send-keys M-t' 'select-pane -U'
bind-key -n M-n if-shell 'test "#{pane_current_command}" = vim' 'send-keys M-n' 'select-pane -D'
bind-key -n M-s if-shell 'test "#{pane_current_command}" = vim' 'send-keys M-s' 'select-pane -R'
set-option -g mouse-select-pane on

# resize pane
bind-key -r H resize-pane -L 5
bind-key -r T resize-pane -U 5
bind-key -r N resize-pane -D 5
bind-key -r S resize-pane -R 5
set-option -g mouse-resize-pane on

# zoom pane
bind-key -n M-m resize-pane -Z

# swap pane
bind-key -n M-- swap-pane -D
bind-key -n M-_ swap-pane -U
bind-key -n M-D run-shell 'tmux select-pane -l \; swap-pane -d -s #D'
bind-key -n M-H run-shell 'tmux select-pane -L \; swap-pane -d -s #D'
bind-key -n M-T run-shell 'tmux select-pane -U \; swap-pane -d -s #D'
bind-key -n M-N run-shell 'tmux select-pane -D \; swap-pane -d -s #D'
bind-key -n M-S run-shell 'tmux select-pane -R \; swap-pane -d -s #D'

# attach by number
bind-key M-1 join-pane -t :1
bind-key M-2 join-pane -t :2
bind-key M-3 join-pane -t :3
bind-key M-4 join-pane -t :4
bind-key M-5 join-pane -t :5
bind-key M-6 join-pane -t :6
bind-key M-7 join-pane -t :7
bind-key M-8 join-pane -t :8
bind-key M-9 join-pane -t :9

# promote pane (toggle)
bind-key -n M-Enter if-shell 'test #P -ne 1' 'select-pane -t 1' 'last-pane; swap-pane -s 1'

# rotate panes
bind-key -n M-a rotate-window -D
bind-key -n M-A rotate-window -U

#-----------------------------------------------------------------------------
# layouts
#-----------------------------------------------------------------------------

bind-key -n M-w select-layout main-horizontal
bind-key -n M-W select-layout even-vertical
bind-key -n M-v select-layout main-vertical
bind-key -n M-V select-layout even-horizontal
bind-key -n M-z select-layout tiled

# main-horizontal layout with the main pane occupying half of the screen
bind-key -n M-w select-layout main-horizontal \; run-shell 'tmux resize-pane -t 1 -y $(expr #{window_height} / 2)'

# main-vertical layout with the main pane occupying half of the screen
bind-key -n M-v select-layout main-vertical \; run-shell 'tmux resize-pane -t 1 -x $(expr #{window_width} / 2)'

#-----------------------------------------------------------------------------
# scrollback buffer
#-----------------------------------------------------------------------------

# buffer length
set-option -g history-limit 32767

# search buffer (using less if Vim is not available)
bind-key -n M-/ capture-pane -S -32767 \; new-window ' \
  tmux save-buffer - \; delete-buffer | {              \
    vim -R -c "set nofen is hls ic" -;                 \
    test $? -eq 127 && less;                           \
  };                                                   \
' \; send-keys G ? # go to bottom and search upward

# scroll buffer
# NOTE: set "URxvt.saveLines: 0" in ~/.Xdefaults to make Shift+PageUp bindable
# NOTE: see http://aperiodic.net/screen/interface for doing the same in XTerm
bind-key -n S-PPage copy-mode -u

# copy text from buffer
bind-key -n M-u copy-mode
set-window-option -g mode-keys vi
bind-key -t vi-copy v begin-selection
bind-key -t vi-copy C-V rectangle-toggle
bind-key -t vi-copy y copy-selection
set-window-option -g mode-mouse on

# transfer copied text to X primary selection
bind-key -n M-y run-shell 'tmux save-buffer - | xsel -p -i'

# transfer copied text to X clipboard selection
bind-key -n M-Y run-shell 'tmux save-buffer - | xsel -b -i'

# paste copied text
bind-key -n M-i paste-buffer

# paste X primary selection
bind-key -n M-p run-shell 'xsel -p -o | tmux load-buffer - \; paste-buffer \; delete-buffer'

# paste X clipboard selection
bind-key -n M-P run-shell 'xsel -b -o | tmux load-buffer - \; paste-buffer \; delete-buffer'
