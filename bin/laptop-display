#!/bin/sh -e
#
# Uses external display if connected; or internal display otherwise.
#
# Written in 2014 by Suraj N. Kurapati <https://github.com/sunaku>

# detect and register active displays as variables in this script
eval $(xrandr --verbose | awk '
  $2 ~ /connected/ {
    device=$1
    gsub("-", "", $1)
    display=$1
    print display "=" device
    print display "_connected=" ($2 == "connected")
  }
  $1 ~ /^[[:digit:]]+x[[:digit:]]+/ {
    if ($NF == "*current") {
      print display "_active=1"
      print display "_size=" $1
    }
    if ($NF == "+preferred") {
      print display "_preferred_size=" $1
    }
    # override preferred_size with max resolution
    if (!max_resolution[display]) {
      max_resolution[display] = $1
      print display "_preferred_size=" $1
    }
  }
')

if test "$DisplayPort0_connected" = 1; then
  # switch off internal display and use external one
  xrandr "$@" --output "$eDP" --off \
              --output "$DisplayPort0" --mode "$DisplayPort0_preferred_size"

  gsettings set org.cinnamon.desktop.interface text-scaling-factor 1.4

else
  # no external displays connected; use internal one
  xrandr "$@" --auto

  # reduce brightness of internal display backlight
  xbacklight | grep -q -x 100 && xbacklight = 15

  gsettings set org.cinnamon.desktop.interface text-scaling-factor 1.25
fi
