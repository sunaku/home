#!/bin/bash
#
# Usage: tmux-osc52 [FILE...]
#
# Copies the contents of the given files (or STDIN if no files are given) to
# the terminal that attaches a tmux(1) session and runs this program therein.
# This is achieved by writing an OSC 52 escape sequence to the said terminal.
#
# The OSC 52 escape sequence in tmux(1) imposes an 8-byte overhead (7 bytes
# for the header and 1 byte for the footer) and thereby limits its payload to
# a maximum length of 99,992 bytes.  Moreover, since this payload is encoded
# in base64, the maximum amount of copyable text is effectively 74,994 bytes.
#
# See http://en.wikipedia.org/wiki/Base64 for the 4*ceil(n/3) length formula.
# See http://sourceforge.net/p/tmux/mailman/message/32221257 for copy limits.
# See http://sourceforge.net/p/tmux/tmux-code/ci/a0295b4c2f6 for DCS in tmux.
#
printf '\ePtmux;\e\e]52;c;%s\a\e\\' "$(cat "$@" | head -c74994 | base64 -w0)"
